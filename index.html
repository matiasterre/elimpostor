<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Impostor Argento PRO üá¶üá∑</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-512.png">
    <meta name="description" content="El mejor juego del Impostor Argentino y Cuyano para previas y reuniones. Versi√≥n argentina con modismos, palabras cuyanas y pistas secretas. ¬°Ideal para jugar con amigos!">
    <meta name="keywords" content="juego del impostor, el impostor argemtomp online, juego previa, palabras argentinas, impostor argento, impostor argentino, juego de mesa gratis">
    <meta name="author" content="Terrepolis">

    <meta property="og:title" content="Impostor Argento PRO üá¶üá∑">
    <meta property="og:description" content="¬øQui√©n es el infiltrado? Jug√° al juego del impostor con tus amigos. ¬°Gratis y sin descargar nada!">
    <meta property="og:image" content="https://elimpostor.ar/icon-512.png">
    <meta property="og:url" content="https://elimpostor.ar">
    <meta property="og:type" content="website">
    <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Impostor Argento PRO",
        "operatingSystem": "Web",
        "applicationCategory": "GameApplication",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "ARS"
        },
        "author": {
            "@type": "Person",
            "name": "Terrepolis"
        },
        "description": "Juego de deducci√≥n social basado en palabras argentinas. Incluye modo impostor con pistas y categor√≠as personalizadas."
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        :root { --celeste: #74ACDF; --blanco: #FFFFFF; --oro: #F6B40E; --oscuro: #202020; --rojo: #ff6b6b; --verde: #4cd137; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--oscuro); color: white; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .container { max-width: 500px; width: 100%; background: #333; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid var(--celeste); box-sizing: border-box; box-shadow: 0 10px 25px rgba(0,0,0,0.5); margin-bottom: 20px; }
        h1 { color: var(--celeste); margin: 0 0 15px 0; font-size: 1.8em; }
        .setup-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; color: #ccc; }
        select, input { width: 100%; padding: 12px; border-radius: 8px; border: none; margin-bottom: 10px; box-sizing: border-box; background: #eee; font-size: 1em; color: black; }
        .switch-row { display: flex; align-items: center; justify-content: space-between; background: #444; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        .help-icon { background: #666; color: white; border-radius: 50%; width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; margin-left: 10px; font-weight: bold; border: 1px solid #999; }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--verde); }
        input:checked + .slider:before { transform: translateX(22px); }
        button { border: none; padding: 15px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 1.1em; }
        .hidden { display: none; }
        .card { background: var(--blanco); color: var(--oscuro); padding: 40px 20px; border-radius: 15px; margin: 20px 0; font-size: 1.6em; font-weight: bold; border: 5px solid var(--oro); text-transform: uppercase; min-height: 120px; display: flex; align-items: center; justify-content: center; flex-direction: column; text-align: center; }
        #timer-display { font-size: 3em; color: var(--oro); font-weight: bold; margin: 10px 0; font-family: monospace; }
        #starter-badge { background: var(--oro); color: black; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; font-size: 1.1em; }
        .vote-btn { background-color: #444; color: white; margin: 5px 0; border: 1px solid #666; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .modal-content { background: #333; padding: 25px; border-radius: 20px; border: 2px solid var(--oro); text-align: center; max-height: 85vh; overflow-y: auto; width: 100%; max-width: 400px; }
        .hint-badge { font-size: 0.6em; color: #fff; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 8px; margin-top: 20px; font-weight: normal; border: 1px dashed var(--oro); line-height: 1.2; }
        .player-name-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            border: 1px solid #555;
            background: #fff;
            color: #000;
            font-size: 0.9em;
        }
        #dynamic-names-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
        }
        .player-name-input::placeholder {
            color: #888;
        }

        #timer-display {
            font-variant-numeric: tabular-nums; /* Para que los n√∫meros no salten */
            min-width: 100px;
            text-align: center;
        }
    </style>

</head>
<body>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7BVKPBPH73"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7BVKPBPH73');
    </script>

    <div id="how-to-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--oro)">C√≥mo Jugar üá¶üá∑</h2>
            <div style="text-align: left; font-size: 0.9em; line-height: 1.4;">
                <p>1. Todos ven la palabra menos el <b>Impostor</b>.</p>
                <p>2. Cada uno dice <b>una palabra</b> relacionada al secreto.</p>
                <p>3. El sistema elige qui√©n arranca.</p>
                <p>4. <b>Victoria Ciudadana:</b> Votan al impostor.</p>
                <p>5. <b>Victoria Impostor:</b> Adivina la palabra o gana la mayor√≠a.</p>
            </div>
            <button onclick="closeModal('how-to-modal')" style="background: var(--celeste)">ENTENDIDO</button>
        </div>
    </div>

    <div id="guess-rule-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--oro)">Regla de Arriesgar</h2>
            <p>El Impostor puede intentar adivinar la palabra para ganar el juego autom√°ticamente.</p>
            <button onclick="closeModal('guess-rule-modal')" style="background: var(--celeste)">OK</button>
        </div>
    </div>

    <div class="container" id="setup-screen">
        <h1>Impostor Argento PRO üá¶üá∑</h1>
        <button id="install-btn" style="display: none; background-color: var(--oro); margin-bottom: 15px; color: black;">üì≤ INSTALAR APP</button>
        <button onclick="document.getElementById('how-to-modal').style.display='flex'" style="background: #555; font-size: 0.9em; color: white;">‚ùì REGLAS</button>

        <div class="setup-group" style="margin-top:20px;">
            <label>Jugadores:</label>
            <select id="totalPlayers"></select>
            <label>Impostores:</label>
            <select id="impostorCount"></select>
            <label>Tiempo de Debate:</label>
            <select id="debateMinutes"></select>
            
            <div class="switch-row">
                <span>Arriesgar Palabra <span class="help-icon" onclick="document.getElementById('guess-rule-modal').style.display='flex'">?</span></span>
                <label class="switch">
                    <input type="checkbox" id="allowGuess" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="switch-row">
                <span>Nombres Personalizados</span>
                <label class="switch">
                    <input type="checkbox" id="customNames" onchange="toggleNameInputs()">
                    <span class="slider"></span>
                </label>
            </div>

            <div id="names-setup-container" class="hidden" style="background: #444; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <p style="font-size: 0.8em; color: var(--oro); margin-top: 0;">Complet√° los nombres:</p>
                <div id="dynamic-names-list"></div>
            </div>

            <div class="switch-row">
                <span>Pista para Impostor üí°</span>
                <label class="switch">
                    <input type="checkbox" id="allowHint" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <label>Categor√≠a:</label>
            <select id="wordSource" onchange="toggleCustomWord()">
                <option value="random">Aleatoria (Argentina General)</option>
                <option value="cuyo">Modismos Cuyanos üçá</option>
                <option value="jugadores">Jugadores Argentinos</option>
                <option value="custom">Escribir mi propia palabra</option>
            </select>
            <div id="customWordDiv" class="hidden"><input type="text" id="customWord" placeholder="Escrib√≠ la palabra secreta"></div>
        </div>
        <button onclick="startGame()" style="background: var(--verde); color: white;">¬°REPARTIR!</button>
         <div id="stats-board" style="margin: 20px 0; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px dashed var(--celeste);">
            <div style="margin-bottom: 8px;">
                <span style="font-size: 0.85em; color: #aaa;">üåç Partidas globales:</span>
                <strong id="global-counter" style="color: var(--verde); font-size: 1.1em;">0</strong>
            </div>
            <div>
                <span style="font-size: 0.85em; color: #aaa;">üî• Tu racha personal:</span>
                <strong id="match-counter" style="color: var(--rojo); font-size: 1.1em;">0</strong>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 15px;">
            <small id="version-label" style="color: rgba(255,255,255,0.5); font-weight: bold;">
                Cargando versi√≥n...
            </small>
        </div>

        <div style="margin-top: 30px; opacity: 0.5;">
            <button onclick="forceUpdateApp()" style="background: none; color: #ccc; font-size: 0.7em; text-decoration: underline; border: none; padding: 5px; width: auto;">
                üîÑ Verificar actualizaciones
            </button>
        </div>

        <a href="https://cafecito.app/terrepolis" rel="noopener" target="_blank" id="cafecito-fixed" style="display: flex; align-items: center; justify-content: center; background-color: #00CCFF; border-radius: 12px; padding: 12px; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 10px; transition: transform 0.2s;">
            <img src="https://cdn.cafecito.app/imgs/buttons/button_5.png" alt="Invitame un cafecito" style="height: 28px; width: auto;" />
            <span style="color: white; font-weight: bold; margin-left: 10px; font-size: 0.95em;">¬øTe cop√°s?</span>
        </a>

    </div>

    <div class="container hidden" id="names-screen">
        <h2 style="color: var(--oro)">¬øQui√©nes juegan?</h2>
        <div id="names-container" style="margin-bottom: 20px;"></div>
        <button onclick="confirmNames()" style="background: var(--verde); color: white;">¬°LISTO, A REPARTIR!</button>
    </div>

   <div class="container hidden" id="game-screen">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 5px; margin-top: -10px;">
            <button onclick="confirmExit()" style="background: none; border: none; color: rgba(255,255,255,0.6); font-size: 2em; cursor: pointer; padding: 10px;">
                ‚Ü∫
            </button>
            
            <button id="pause-btn" onclick="togglePause()" style="background: none; border: none; color: rgba(255,255,255,0.6); font-size: 1.6em; cursor: pointer; padding: 10px;">
                ‚è∏
            </button>
        </div>

        <h1>¬øQui√©n es el impostor?</h1>
        <p style="font-size: 0.9em; opacity: 0.8;">Debatan y traten de descubrir al infiltrado antes de que se acabe el tiempo.</p>
        
        <div id="timer" style="font-size: 3.5em; font-weight: bold; margin: 15px 0; color: #ff5252; text-shadow: 0 0 15px rgba(255,82,82,0.4);">00:00</div>
        
        <button class="btn-primary" onclick="endGame()">Finalizar Partida</button>
    </div>

    <div class="container hidden" id="debate-screen">
        <div id="timer-display">00:00</div>
        <div id="starter-badge"></div>
        <div id="vote-list"></div>
        <div id="impostor-guess-zone" class="hidden">
            <button onclick="showScreen('guess-screen')" style="background: var(--oro); color: black;">üî• EL IMPOSTOR ARRIESGA</button>
        </div>
    </div>

    <div class="container hidden" id="guess-screen">
        <h2 style="color: var(--oro)">ADIVIN√Å LA PALABRA</h2>
        <input type="text" id="impostorGuessInput" placeholder="¬øQu√© palabra es?">
        <button onclick="checkImpostorGuess()" style="background: var(--verde); color: white;">VERIFICAR</button>
        <button onclick="showScreen('debate-screen')" style="background: #555; color: white;">VOLVER</button>
    </div>

    <div class="container hidden" id="result-screen">
        <h1 id="result-title"></h1>
        <p id="result-text" style="font-size: 1.2em; line-height: 1.4;"></p>
        <button onclick="resetGame()" style="background: var(--celeste)">NUEVA PARTIDA</button> 
    </div>

    <div style="text-align: center; margin-top: 15px;">
        <button onclick="sugerirPalabra()" style="background: #e1306c; color: white; border: none; padding: 12px 25px; border-radius: 50px; font-weight: bold; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; width: auto;">
        <span>üí°</span> SUGERIR PALABRA O MEJORA üòé
        </button>
    </div>

    <div style="text-align: center; margin: 20px 0;">
        <button onclick="compartirJuego()" style="background: #25d366; color: white; border: none; padding: 12px 25px; border-radius: 50px; font-weight: bold; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; width: auto;">
        <span>üöÄ</span> COMPARTIR JUEGO
        </button>
    </div>

    <div style="width: 100%; text-align: center; margin-top: 30px; margin-bottom: 20px; opacity: 0.6;">
        <a href="https://www.instagram.com/terrepolis" target="_blank" style="color: #ccc; text-decoration: none; font-style: italic; font-size: 0.85em;">
        hecha por <span style="border-bottom: 1px solid #555;">@terrepolis</span>
        </a>
    </div>

    <div style="display:none;">
    <h2>Sobre el Impostor Argento</h2>
    <p>Este es un juego de deducci√≥n donde un grupo de ciudadanos conoce una palabra secreta y un impostor debe descubrirla sin ser detectado. Es ideal para fiestas, reuniones familiares y previas. Incluye categor√≠as de cultura argentina y modismos regionales.</p>
    </div>

<script>
    let matchCount = parseInt(localStorage.getItem('mis_partidas_total')) || 0;

        // Los datos que te dio la consola de Firebase
    const firebaseConfig = {
    apiKey: "AIzaSyDr0BH9hH4hHnXyFkjGEEIsRvpl2LoXhd8",
    authDomain: "elimpostorar.firebaseapp.com",
    databaseURL: "https://elimpostorar-default-rtdb.firebaseio.com",
    projectId: "elimpostorar",
    storageBucket: "elimpostorar.firebasestorage.app",
    messagingSenderId: "723801338440",
    appId: "1:723801338440:web:39115cfa67dc966af2de7d",
    measurementId: "G-47KYJY2PVT"
    };

    // Inicializamos
    firebase.initializeApp(firebaseConfig);
    const databaseFB = firebase.database();
    const globalCountRef = databaseFB.ref('contador_global');
    const APP_VERSION = 23;
    const PARTIDAS_BASE = 123357;


    // ESCUCHAR CAMBIOS: Cada vez que alguien en el mundo juegue, este c√≥digo se ejecuta solo
    globalCountRef.on('value', (snapshot) => {
        const totalDesdeFirebase = snapshot.val() || 0;
        const totalReal = PARTIDAS_BASE + totalDesdeFirebase;
        const el = document.getElementById('global-counter');
        if(el) el.innerText = totalReal.toLocaleString();
    });

    const database = [
        // --- CULTURA Y PERSONAJES ---
        ["Messi", "√çcono"], ["Maradona", "Mito"], ["San Mart√≠n", "Leyenda"], ["Belgrano", "S√≠mbolo"], ["Favaloro", "Legado"], ["Borges", "Intelecto"], ["Cerati", "Arte"], ["Gilda", "Popular"], ["Dibu Mart√≠nez", "Actualidad"], ["Susana Gim√©nez", "Espect√°culo"], ["Mirtha Legrand", "Espect√°culo"], ["Santi Maratea", "Influencia"], ["Paulina Cocina", "Contenido"], ["Bizarrap", "M√∫sica"], ["Ricardo Fort", "Personaje"], ["Gaucho", "Figura"], ["Pibe", "Identidad"], ["Piba", "Identidad"], ["Vecino", "Cercan√≠a"], ["Portero", "Oficio"], ["Kiosquero", "Oficio"], ["Pe√≥n", "Esfuerzo"],

        // --- GASTRONOM√çA Y RITUALES ---
        ["Mate", "Ritual"], ["Fernet", "Identidad"], ["Asado", "Reuni√≥n"], ["Empanada", "Cl√°sico"], ["Milanesa", "Tradici√≥n"], ["Chorip√°n", "Popular"], ["Alfajor", "Regional"], ["Locro", "Patrio"], ["Humita", "Nacional"], ["Dulce de Leche", "Sabor"], ["Chocotorta", "Celebraci√≥n"], ["Facturas", "Costumbre"], ["Pastelitos", "Tradici√≥n"], ["Birra", "Encuentro"], ["Vino Tinto", "S√≠mbolo"], ["Chip√°", "T√≠pico"], ["Flan", "Final"], ["Medialunas", "Cl√°sico"], ["Churros", "Paseo"], ["Pan Dulce", "Temporada"], ["Garrapi√±adas", "Callejero"], ["Guiso de Lentejas", "Casero"], ["Fain√°", "Complemento"], ["Pizza", "Compartido"], ["Sorrentinos", "Almuerzo"], ["Sandwich de Miga", "Evento"], ["Mayonesa", "Aderezo"], ["Helado", "Placer"], ["Salame", "Picada"], ["Aceite de Oliva", "Producto"], ["Bondiola", "S√°ndwich"], ["Morcip√°n", "Cancha"], ["Mantecol", "Fiestas"], ["Tita", "Golosina"], ["Rodhesia", "Golosina"], ["Bife de Chorizo", "Gastronom√≠a"], ["Chivito", "Cena"], ["Picada", "Previa"], ["Mate Cocido", "Desayuno"], ["Frutilla con Crema", "Postre"], ["Postre Vigilante", "Cl√°sico"], ["Achuras", "Parrillada"], ["Brasas", "Energ√≠a"], ["Parrilla", "Fuego"], ["Sobremesa", "Charla"], ["Matear", "Acci√≥n"], ["Mateada", "Encuentro"], ["Fog√≥n", "Fuego"], ["Fiado", "Confianza"],

        // --- OBJETOS Y COTIDIANIDAD ---
        ["SUBE", "Cotidiano"], ["Sif√≥n", "Presi√≥n"], ["Bondi", "Urbano"], ["DNI", "Tarjeta"], ["Boleadoras", "Elemento"], ["Pumper Nic", "Nostalgia"], ["Cindor", "Infancia"], ["Bazooka", "Golosina"], ["Pelopincho", "Verano"], ["Termidor", "Econ√≥mico"], ["Guaymall√©n", "Popular"], ["Movicom", "Tecnolog√≠a"], ["Cospel", "Viaje"], ["Chomba", "Vestimenta"], ["Pilcha", "Vestimenta"], ["Zapatillas", "Calzado"], ["Ojotas", "Calzado"], ["Alpargatas", "Calzado"], ["Bombacha de Campo", "Vestimenta"], ["Poncho", "Prenda"], ["Sombrilla", "Protecci√≥n"], ["Reposera", "Descanso"], ["Billetera", "Accesorio"], ["Heladera", "Hogar"], ["Ventilador", "Alivio"], ["Estufa", "Clima"], ["Semaforo", "Orden"], ["Cuerda", "Elemento"], ["Chapas", "Material"], ["Revoque", "Material"], ["Obra", "Construcci√≥n"],

        // --- LUGARES Y PAISAJES ---
        ["Obelisco", "Referencia"], ["Cabildo", "Hist√≥rico"], ["Aconcagua", "Naturaleza"], ["Ushuaia", "Geograf√≠a"], ["Patagonia", "Regi√≥n"], ["Estancia", "Campo"], ["Tranqueras", "L√≠mite"], ["Pulper√≠a", "Historia"], ["Almac√©n", "Barrio"], ["Plaza", "P√∫blico"], ["Parque", "Espacio"], ["Vereda", "Calle"], ["Esquina", "Encuentro"], ["Boliche", "Noche"], ["Costa", "Destino"], ["Balneario", "Recreaci√≥n"], ["Ruta", "Trayecto"], ["Banquina", "Margen"], ["Peaje", "Transici√≥n"], ["Ascensor", "Vertical"], ["Balc√≥n", "Exterior"], ["Patio", "Privado"], ["Pileta", "Agua"], ["Pampa", "Horizonte"],

        // --- CONCEPTOS, LENGUAJE Y VARIOS ---
        ["Siesta", "H√°bito"], ["Zorro", "Fauna"], ["Carpincho", "Fauna"], ["Yacar√©", "Fauna"], ["√ëand√∫", "Fauna"], ["Vizcacha", "Fauna"], ["Carpincho", "Fauna"], ["Chacarera", "Ritmo"], ["Zamba", "Ritmo"], ["Malambo", "Ritmo"], ["Payada", "Palabra"], ["Guita", "Econom√≠a"], ["Laburo", "Actividad"], ["Quilombo", "Situaci√≥n"], ["Che", "Vocalizaci√≥n"], ["Gauchada", "Acci√≥n"], ["Charla", "Comunicaci√≥n"], ["Dominguero", "Familiar"], ["Humedad", "Atmosfera"], ["Baldazo", "Sorpresa"], ["Vuelto", "Intercambio"], ["Moneda", "Valor"], ["Billete", "Valor"], ["D√≥lar", "Preocupaci√≥n"], ["Guardapolvo", "Instituci√≥n"], ["Tiza", "Herramienta"], ["Recreo", "Intervalo"], ["Pizarr√≥n", "Exposici√≥n"], ["Bocinazo", "Sonido"],

        // --- EDUCACI√ìN Y ESCUELA ---
        ["Cartuchera", "√ötiles"], ["Cuaderno", "Papel"], ["Carpeta", "Estudio"]
    ];

    const databaseCuyana = [
        // --- CUYO ¬∑ IDENTIDAD Y HABLA ---
        ["Cuyan√≠a", "Pertenencia"], ["Manso", "Intensidad"], 
        ["Minga", "Negaci√≥n"],
        ["Manyineada", "Picard√≠a"],
        ["Guasear", "Exageraci√≥n"],
        ["Pajuerano", "Desplazado"],
        ["Pajar√≥n", "Ingenuidad"],
        ["Hurgar", "Curiosidad"],
        ["Huev√≥n", "Descalificaci√≥n"],
        ["Gorriao", "Desencanto"],
        ["Chuncano", "Torpeza"],
        ["Ni√±o", "Afecto"],
        ["Abombado", "Aturdimiento"],
        ["Abatatarse", "Verg√ºenza"],

        // --- CUYO ¬∑ CALLE Y VIDA URBANA ---
        ["Chusmear", "Observaci√≥n"],
        ["Chancletazo", "Correcci√≥n"],
        ["Tincazo", "Advertencia"],
        
        // --- CUYO ¬∑ TERRITORIO Y AGUA ---
        ["Zonda", "Presi√≥n"],
        ["Acequia", "Circulaci√≥n"],
        ["Cuneta", "Borde"],
        ["Pirca", "L√≠mite"],
        ["Remanso", "Peligro"],
        ["Crecida", "Desborde"],
        ["Barranca", "Corte"],
        ["Vado", "Paso"],
        ["Cauce", "Direcci√≥n"],
        ["Zanj√≥n", "Profundidad"],
        ["M√©dano", "Movimiento"],
        ["Salitral", "Aridez"],
        ["Hondonada", "Refugio"],
        ["Pe√±√≥n", "Fijeza"],
        ["Quebrada", "Quiebre"],
        ["Cerro", "Presencia"],
        ["Loma", "Suavidad"],
        ["Precordillera", "Antesala"],

        // --- CUYO ¬∑ CAMPO Y TRABAJO ---
        ["Puesto", "Aislamiento"],
        ["Puestero", "Custodia"],
        ["Chacra", "Producci√≥n"],
        ["Monte", "Resistencia"],
        ["Rastrojo", "Despu√©s"],
        ["Jarilla", "Amarillo"],
        ["Retamo", "Aspereza"],
        ["Cha√±ar", "Dulzura"],
        ["Algarrobo", "Origen"],
        ["Vi√±a", "Ciclo"],
        ["Vi√±atero", "Oficio"],
        ["Vendimia", "Ritual"],
        ["Parra", "Sombra"],
        ["Parral", "Estructura"],
        ["Sarmiento", "Restos"],
        ["Mosto", "Inicio"],
        ["Borra", "Sedimento"],
        ["Challa", "Ofrenda"],
        ["Arriero", "Tr√°nsito"],
        ["Arriar", "Conducci√≥n"],
        ["Tropilla", "Conjunto"],
        ["Aperos", "Preparaci√≥n"],
        ["Petiso", "Altura"],
        ["Ch√∫caro", "Ind√≥mito"],
        ["Domar", "Proceso"],
        ["Juntar", "Reuni√≥n"],
        ["Apartar", "Selecci√≥n"],

        // --- CUYO ¬∑ OBJETOS Y COTIDIANO ---
        ["Pilchas", "Apariencia"],
        ["Zaino", "Color"],
        ["Engarilla", "Carga"],
        ["Carrear", "Esfuerzo"],
        ["Carro", "Traslado"],
        ["Toldo", "Sombra"],
        ["Enramada", "Cobijo"],
        ["Rancho", "Simplicidad"],
        ["Galp√≥n", "Resguardo"],
        ["Alero", "Protecci√≥n"],
        ["Fog√≥n", "Centro"],
        ["Le√±a", "Recurso"],
        ["Rescoldo", "Persistencia"],
        ["Mortero", "Transformaci√≥n"],
        ["Tacho", "Contenci√≥n"],
        ["Chicote", "Impulso"],
        ["Encimar", "Superposici√≥n"],
        ["Apilar", "Orden"],

        // --- CUYO ¬∑ COCINA Y ABUELA ---
        ["Tortita", "Ritual"],
        ["Semita", "Tradici√≥n"],
        ["Sopaipilla", "Abrigo"],
        ["Cacho", "Abundancia"],
        ["Camote", "Ra√≠z"],
        ["Beterava", "Herencia"],
        ["Arrope", "Concentraci√≥n"],
        ["Mazacote", "Abundancia"],
        ["Chorreado", "Exceso"],
        ["Conserva", "Frasco"],
        ["Sobar", "Mano"],

        // --- CUYO ¬∑ CLIMA Y SENSACI√ìN ---
        ["Polvareda", "Visibilidad"],
        ["Rajadura", "Tensi√≥n"],
        ["Reseco", "Sequedad"],
        ["Aguada", "Alivio"],
        ["Bebedero", "Pausa"],
        ["Repuntar", "Mejora"],
        ["Amainar", "Descenso"],
        
        // --- CUYO ¬∑ ANIMALES Y PRESENCIA ---
        ["Choco", "Compa√±√≠a"],
        ["Mishi", "Silencio"],
        
    ];

    const databaseJugadoresArgentinos = [

    // --- DEFENSORES / MARCA / CENTRALES ---
    ["Nicol√°s Burdisso", "Defensor"],
    ["Gonzalo Rodr√≠guez", "Central"],
    ["Jonathan Maidana", "Central"],
    ["Walter Samuel", "Muro defensivo"],
    ["Nicol√°s Pareja", "Central"],
    ["Germ√°n Pezzella", "Juego a√©reo"],
    ["Walter Kannemann", "Defensor rocoso"],
    ["Cristian Romero", "Defensor rocoso"],
    ["Marcos Rojo", "Car√°cter"],
    ["Hugo Campagnaro", "Defensor"],
    ["Marcos Senesi", "Central"],
    ["Oscar Ruggeri", "Defensor campe√≥n"],
    ["Facundo Medina", "Defensor rocoso"],
    ["Mart√≠n Demichelis", "Defensor"],
    ["Jos√© Basanta", "Central"],
    ["Roberto Ayala", "Muralla"],
    ["Luis Galv√°n", "Defensor rocoso"],
    ["Roberto Perfumo", "Defensor hist√≥rico"],
    ["Alberto Tarantini", "Lateral"],
    ["Jorge Olgu√≠n", "Lateral"],
    ["Jos√© Chamot", "Defensor"],
    ["Federico Fern√°ndez", "Central"],
    ["Fabricio Coloccini", "Central"],
    ["Federico Fazio", "Central alto"],
    ["Lisandro Mart√≠nez", "Defensor t√©cnico"],
    ["Gabriel Heinze", "Car√°cter"],
    ["Gabriel Mercado", "Defensor"],
    ["Lucas Mart√≠nez Quarta", "Central"],
    ["Juan Foyth", "Defensor t√©cnico"],
    ["Kevin Mac Allister", "Defensor"],

    // --- VOLANTES / CEREBRO / MARCA ---
    ["Cristian Medina", "Volante"],
    ["Mat√≠as Kranevitter", "5 de marca"],
    ["H√©ctor Enrique", "Asistidor"],
    ["Leandro Paredes", "Volante central"],
    ["Ricardo Bochini", "Enganche"],
    ["Mat√≠as Zaracho", "Volante"],
    ["Giovani Lo Celso", "Volante creativo"],
    ["Norberto Alonso", "Enganche cl√°sico"],
    ["Aldo Duscher", "Volante"],
    ["Ricardo Giusti", "Volante"],
    ["Rodrigo De Paul", "Intensidad"],
    ["Enzo Fern√°ndez", "Motor del equipo"],
    ["Lucas Biglia", "Volante central"],
    ["Nicol√°s Dom√≠nguez", "Volante"],
    ["Fernando Redondo", "Elegancia"],
    ["Juan Sebasti√°n Ver√≥n", "Cerebro"],
    ["Pablo Aimar", "Asistidor"],
    ["Ever Banega", "Tiro libre"],
    ["Guido Rodr√≠guez", "5 de marca"],
    ["Sergio Batista", "5 de marca"],
    ["Fernando Gago", "Volante fino"],
    ["Esteban Cambiasso", "Volante t√°ctico"],
    ["Diego Simeone", "5 de marca"],
    ["Lucas Leiva", "5 de marca"],
    ["Mat√≠as Almeyda", "5 de marca"],
    ["Leonardo Ponzio", "Capit√°n"],
    ["Enzo P√©rez", "Pulm√≥n"],
    ["Fernando Belluschi", "Volante ofensivo"],
    ["Pablo Gui√±az√∫", "Entrega total"],
    ["Ignacio Fern√°ndez", "Volante goleador"],
    ["Santiago Ascac√≠bar", "5 de marca"],
    ["Guido Pizarro", "Volante"],
    ["Jos√© Sosa", "Volante fino"],
    ["Agust√≠n Palavecino", "Volante"],
    ["Alan Varela", "5 de marca"],
    ["Santiago Hezze", "Volante"],

    // --- DELANTEROS / GOLEADORES / ATAQUE ---
    ["Lisandro L√≥pez", "Referente"],
    ["Lucas Pratto", "9 de finales"],
    ["Leopoldo Luque", "Goleador"],
    ["Claudio Caniggia", "Velocidad pura"],
    ["Ezequiel Lavezzi", "Extremo"],
    ["Mat√≠as Su√°rez", "Delantero t√©cnico"],
    ["Guillermo Barros Schelotto", "Picard√≠a"],
    ["Sergio Ag√ºero", "Goleador"],
    ["Rodrigo Palacio", "Delantero vers√°til"],
    ["Ren√© Houseman", "Gambeta"],
    ["Hern√°n Crespo", "Goleador"],
    ["Lucas Ocampos", "Extremo potente"],
    ["Giovani Simeone", "Goleador"],
    ["Emmanuel Gigliotti", "Goleador"],
    ["Diego Milito", "H√©roe continental"],
    ["Jorge Valdano", "Goleador"],
    ["Gonzalo Higua√≠n", "Goleador"],
    ["Ram√≥n D√≠az", "Goleador"],
    ["Lucas Alario", "9 oportunista"],
    ["√Ångel Correa", "Versatilidad"],
    ["Sebasti√°n Driussi", "Goleador joven"],
    ["Alejandro G√≥mez", "Jugador creativo"],
    ["Nicol√°s Gait√°n", "Habilidad"],
    ["Lautaro Mart√≠nez", "9 de √°rea"],
    ["Paulo Dybala", "Zurda fina"],
    ["Juli√°n √Ålvarez", "Goleador joven"],
    ["Mart√≠n Palermo", "Goleador de Boca"],
    ["Esteban Fuertes", "Goleador de club"],
    ["Eduardo Salvio", "Extremo"],
    ["Mauro Z√°rate", "Zurda"],
    ["Dar√≠o Benedetto", "9 de √°rea"],
    ["Walter Bou", "Goleador"],
    ["Ram√≥n √Åbila", "9 de √°rea"],
    ["Ignacio Scocco", "Definici√≥n letal"],
    ["Gonzalo Mart√≠nez", "Gol hist√≥rico"],
    ["Nicol√°s Gonz√°lez", "Extremo"],
    ["Lucas Boy√©", "Delantero"],
    ["Facundo Buonanotte", "Promesa"],
    ["Valent√≠n Carboni", "Promesa"],
    ["Claudio Echeverri", "Promesa"],
    ["Enzo Barrenechea", "Promesa"],
    ["Franco Cervi", "Extremo"],
    ["Cristian Pav√≥n", "Extremo"],
    ["Exequiel Zeballos", "Extremo"],
    ["Valent√≠n Barco", "Promesa"],
    ["Lucas Janson", "Delantero"],
    ["Nicol√°s Blandi", "9 de √°rea"],
    ["Dar√≠o Cvitanich", "Delantero"],
    ["Guido Carrillo", "9 de √°rea"],

    // --- ARQUEROS ---
    ["Agust√≠n Rossi", "Ataja penales"],
    ["Carlos Roa", "Arquero mundialista"],
    ["Franco Armani", "Arquero campe√≥n"],
    ["Nery Pumpido", "Arquero campe√≥n"],
    ["Esteban Andrada", "Mano a mano"],
    ["Ger√≥nimo Rulli", "Arquero"],
    ["Juan Musso", "Reflejos"],
    ["Agust√≠n Marches√≠n", "Reflejos"],
    ["Nahuel Guzm√°n", "Personalidad"],
    ["Sergio Romero", "Arquero de selecci√≥n"],
    ["Emiliano Mart√≠nez", "Ataja penales"],
    ["Carlos Navarro Montoya", "Arquero de culto"],
    ["Sergio Goycochea", "Ataja penales"],
    ["Roberto Abbondanzieri", "Arquero campe√≥n"],
    ["Willy Caballero", "Arquero viajero"],
    ["Mariano And√∫jar", "Arquero confiable"],
    ["Pablo Cavallero", "Arquero"],
    ["Juan Pablo Carrizo", "Arquero"],
    ["Ubaldo Fillol", "Arquero hist√≥rico"],
    ["Germ√°n Burgos", "Arquero de culto"],

    // --- SELECCI√ìN ¬∑ CAMPEONES Y FIGURAS HIST√ìRICAS ---
    ["Daniel Passarella", "Capit√°n campe√≥n"],
    ["Mario Kempes", "Campe√≥n del Mundo"],
    ["Diego Maradona", "Campe√≥n del Mundo"],
    ["Osvaldo Ardiles", "Mundialista"],
    ["Am√©rico Gallego", "Volante de marca"],
    ["Omar Larrosa", "Volante"],
    ["Rub√©n Galv√°n", "Volante"],
    ["Miguel Angel Russo", "Volante"],
    ["Pedro Pasculli", "Gol importante"],
    ["Jos√© Luis Brown", "Gol clave"],
    ["Claudio Borghi", "Talento"],
    ["Ricardo Gareca", "Goleador"],
    ["Abel Balbo", "Goleador"],
    ["Javier Zanetti", "Lateral incansable"],
    ["Daniel Bertoni", "Campe√≥n del Mundo"],
    ["Lionel Messi", "Campe√≥n del Mundo"],
    ["√Ångel Di Mar√≠a", "H√©roe de final"],

    // --- JUGADORES DE CULTO / IMPOSITORES PERFECTOS ---
    ["Ricardo Villa", "Volante"],
    ["Ariel Garc√©", "Selecci√≥n fugaz"],
    ["Cristian Ledesma", "5 t√°ctico"],
    ["Leandro Somoza", "Marca"],
    ["Walter Montillo", "Zurda talentosa"],
    ["Maxi Moralez", "Jugador de culto"],

    // ----- GEMAS DE LA COMUNIDAD ------ //
    ["Laurina Oliveros", "TikTok"],
    ["Florencia Lattanzio", "TikTok"]
];


    let players = [], currentIndex = 0, secretWord = "", secretHint = "", canGuess = true, showHint = true, timerInterval, timeLeft;
    let isPaused = false; // Nueva variable global
    let deferredPrompt;

    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js') // Sin par√°metros de versi√≥n
        .then(reg => {
            console.log("SW registrado");
            // Opcional: Solo recargar si hay un SW nuevo esperando
            reg.onupdatefound = () => {
                const installingWorker = reg.installing;
                installingWorker.onstatechange = () => {
                    if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // Solo recargar cuando el nuevo SW est√© listo
                        window.location.reload();
                    }
                };
            };
        });
    }

    /*
    // Esto recarga la p√°gina autom√°ticamente cuando el SW v12 toma el control
    let refreshing = false;
    navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        window.location.reload();
    });
    */

    function initSetup() {
        const pSel = document.getElementById('totalPlayers');
        const iSel = document.getElementById('impostorCount');
        const tSel = document.getElementById('debateMinutes');
        
        // 1. Llenamos Jugadores (3 a 20)
        pSel.innerHTML = "";
        for(let i=3; i<=20; i++) pSel.options.add(new Option(`${i} Jugadores`, i));
        
        // 2. Llenamos Tiempo (Infinito + 1 a 20 min)
        tSel.innerHTML = "";
        tSel.options.add(new Option(`‚ôæÔ∏è Tiempo Infinito`, 0));
        for(let i=1; i<=20; i++) {
            tSel.options.add(new Option(`${i} Minuto${i>1?'s':''}`, i));
        }
        
        // 3. Valores por defecto
        pSel.value = 4; 
        tSel.value = 7; // Por defecto 7 minutos como pediste

        // 4. L√≥gica din√°mica para Impostores y Nombres
        pSel.onchange = () => { 
            const total = parseInt(pSel.value);
            const maxImpos = Math.floor(total / 2);
        
            // Limpiamos y rellenamos impostores seg√∫n cantidad de jugadores
            iSel.innerHTML = "";
            for(let i=1; i <= (maxImpos < 6 ? maxImpos : 6); i++) {
                iSel.options.add(new Option(`${i} Impostor${i>1?'es':''}`, i));
            }
            
            // Refrescamos nombres si el switch est√° prendido
            if(document.getElementById('customNames').checked) toggleNameInputs(); 
        };
        
        // Ejecutamos una vez para inicializar impostores
        pSel.onchange();
    }

    function toggleNameInputs() {
        const container = document.getElementById('names-setup-container');
        const list = document.getElementById('dynamic-names-list');
        const isChecked = document.getElementById('customNames').checked;
        const total = parseInt(document.getElementById('totalPlayers').value);

        if (isChecked) {
            container.classList.remove('hidden');
            const savedNames = JSON.parse(localStorage.getItem('impostor_nombres')) || [];
            
            // Armamos todo el texto PRIMERO
            let nuevoHTML = "";
            for (let i = 1; i <= total; i++) {
                const savedVal = savedNames[i-1] || "";
                nuevoHTML += `<input type="text" class="player-name-input" 
                    placeholder="Nombre Jugador ${i}" 
                    value="${savedVal}"
                    oninput="saveCurrentNames()"
                    style="margin-bottom: 8px; padding: 10px; width: 100%; border-radius: 5px; border: none; color: black;">`;
            }
            // Lo inyectamos UNA sola vez
            list.innerHTML = nuevoHTML; 
        } else {
            container.classList.add('hidden');
        }
    }

    function saveCurrentNames() {
        const inputs = document.querySelectorAll('.player-name-input');
        const namesToSave = Array.from(inputs).map(inp => inp.value.trim());
        localStorage.setItem('impostor_nombres', JSON.stringify(namesToSave));
    }

    function startGame() {
        isPaused = false; // Resetear pausa
        showScreen('game-screen');
        
        const duration = parseInt(document.getElementById('gameTime').value) * 60;
        timeLeft = duration;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (!isPaused) { // Solo resta si NO est√° pausado
                timeLeft--;
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                document.getElementById('timer').innerText = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    const alarm = document.getElementById('alarm-sound');
                    if (alarm) alarm.play();
                    alert("¬°TIEMPO AGOTADO! A votar...");
                }
            }
        }, 1000);
    }

    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('pause-btn');
        btn.innerText = isPaused ? "‚ñ∂" : "‚è∏";
        // Opcional: que el timer cambie de color cuando est√° pausado
        document.getElementById('timer').style.opacity = isPaused ? "0.5" : "1";
    }

    function confirmExit() {
        if (confirm("¬øSeguro que quer√©s volver al inicio? Se perder√° el progreso de esta partida.")) {
            clearInterval(timerInterval);
            showScreen('setup-screen');
        }
    }



    function showNamesInput(total) {
        const container = document.getElementById('names-container');
        container.innerHTML = "";
        for(let i=1; i<=total; i++) {
            container.innerHTML += `<input type="text" class="player-name-input" placeholder="Nombre Jugador ${i}" style="margin-bottom: 5px;">`;
        }
        showScreen('names-screen');
    }

    function confirmNames() {
        const inputs = document.querySelectorAll('.player-name-input');
        inputs.forEach((input, i) => {
            if(input.value.trim() !== "") {
                players[i].name = input.value.trim();
            }
        });
        finalizeStart();
    }

    function finalizeStart() {
        const imps = parseInt(document.getElementById('impostorCount').value);
        const source = document.getElementById('wordSource').value;
        
        // --- 1. L√ìGICA DE PALABRAS ---
        if (source === 'custom') {
            secretWord = document.getElementById('customWord').value;
            secretHint = "¬°Adivin√° qu√© puse! üòÇ"; 
        } else {
            // --- NUEVA L√ìGICA DE SELECCI√ìN DE DB ---
            let db;
            if (source === 'cuyo') {
                db = databaseCuyana;
            } else if (source === 'jugadores') {
                db = databaseJugadoresArgentinos;
            } else {
                db = database;
            }
            // ---------------------------------------

            let usadas = JSON.parse(localStorage.getItem('palabras_usadas_' + source)) || [];
            let disponibles = db.filter(item => !usadas.includes(item[0]));

            if (disponibles.length < 5) {
                usadas = [];
                disponibles = db;
            }

            const entry = disponibles[Math.floor(Math.random() * disponibles.length)];
            secretWord = entry[0];
            secretHint = entry[1];

            usadas.push(secretWord);
            localStorage.setItem('palabras_usadas_' + source, JSON.stringify(usadas));
        }

        if(!secretWord) return alert("¬°Escrib√≠ una palabra!");

        // --- 2. ASIGNACI√ìN DE ROLES (AZAR PURO) ---
        players.forEach(p => {
            p.role = 'Ciudadano';
            p.alive = true;
        });

        let indices = players.map((_, i) => i);
        for (let i = indices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [indices[i], indices[j]] = [indices[j], indices[i]];
        }

        for (let i = 0; i < imps; i++) {
            let idxImpostor = indices[i];
            players[idxImpostor].role = 'Impostor';
        }

        // --- 3. INICIAR INTERFAZ Y ESTAD√çSTICAS ---
        timeLeft = parseInt(document.getElementById('debateMinutes').value) * 60;
        currentIndex = 0;

        // A. SUMAR AL GLOBAL EN LA NUBE (Firebase)
        globalCountRef.transaction((currentValue) => {
            return (currentValue || 0) + 1;
        });

        // B. SUMAR AL PERSONAL EN EL CELU (LocalStorage)
        matchCount++;
        localStorage.setItem('mis_partidas_total', matchCount);
        
        // C. ACTUALIZAR UI DE ESTAD√çSTICAS
        const mCounter = document.getElementById('match-counter');
        if(mCounter) mCounter.innerText = matchCount;
        
        const sBoard = document.getElementById('stats-board');
        if(sBoard) sBoard.classList.remove('hidden');

        // D. CAMBIAR PANTALLA
        showScreen('game-screen');
        updateTurn();
    } 

    function updateTurn() {
        document.getElementById('turn-info').innerText = `Turno de: ${players[currentIndex].name}`;
        const card = document.getElementById('main-card');
        card.innerText = "TOC√Å PARA VER";
        card.style.background = "white";
        document.getElementById('next-btn').classList.add('hidden');
    }

    
    function revealWord() {
        const card = document.getElementById('main-card');
        const isImp = players[currentIndex].role === "Impostor";
        if (isImp) {
            let hintHTML = (showHint && secretHint !== "Manual") ? `<div class="hint-badge">üí° PISTA: ${secretHint.toUpperCase()}</div>` : "";
            card.innerHTML = `üïµÔ∏è‚Äç‚ôÇÔ∏è SOS EL IMPOSTOR<br><span style="font-size:0.5em; font-weight:normal; margin-top:10px;">No sab√©s la palabra. Disimul√°.</span>${hintHTML}`;
            card.style.background = "#ff6b6b";
        } else {
            card.innerHTML = `LA PALABRA ES:<br><br>${secretWord.toUpperCase()}`;
            card.style.background = "#74ACDF";
        }
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextTurn() {
        currentIndex++;
        if (currentIndex < players.length) updateTurn();
        else startDebate();
    }

    function startDebate() {
        showScreen('debate-screen');
        
        // Elegir qui√©n arranca
        const starter = players[Math.floor(Math.random() * players.length)];
        document.getElementById('starter-badge').innerText = `üöÄ ARRANCA: ${starter.name}`;
        
        renderVoteList();

        // Configuraci√≥n de la zona de arriesgar palabra
        const guessZone = document.getElementById('impostor-guess-zone');
        if(canGuess) {
            guessZone.classList.remove('hidden');
        } else {
            guessZone.classList.add('hidden');
        }
        
        // --- L√ìGICA DEL TEMPORIZADOR ---
        if(timerInterval) clearInterval(timerInterval);
        const selectedMinutes = parseInt(document.getElementById('debateMinutes').value);
        const display = document.getElementById('timer-display');
        display.style.color = "white"; // Reset color por si venimos de una partida anterior

        if (selectedMinutes === 0) {
            // MODO INFINITO
            display.innerText = "DEBATAN PERO NO PELEEN üòÅ";
        } else {
            // MODO CUENTA REGRESIVA
            timeLeft = selectedMinutes * 60;
            
            timerInterval = setInterval(() => {
                if (!isPaused) { // <--- Agregamos este chequeo
                    timeLeft--;
                    const mins = Math.floor(timeLeft / 60);
                    const secs = timeLeft % 60;
                    document.getElementById('timer').innerText = 
                        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        const alarm = document.getElementById('alarm-sound');
                        if (alarm) alarm.play();
                        alert("¬°TIEMPO AGOTADO! A votar...");
                    }
                }
            }, 1000);
        }
    }

    function renderVoteList() {
        const list = document.getElementById('vote-list');
        list.innerHTML = "";
        players.forEach((p, i) => {
            if(p.alive) {
                const btn = document.createElement('button');
                btn.className = "vote-btn";
                btn.innerText = `Votar a ${p.name}`;
                btn.onclick = () => processVote(i);
                list.appendChild(btn);
            }
        });
    }

    function processVote(idx) {
        const p = players[idx];
        p.alive = false;
        const aliveImpos = players.filter(p => p.role === 'Impostor' && p.alive).length;
        const aliveCits = players.filter(p => p.role === 'Ciudadano' && p.alive).length;

        if (p.role === 'Impostor') {
            if (aliveImpos === 0) {
                showResult("¬°GANARON LOS CIUDADANOS! üèÜ", `Atraparon al √∫ltimo impostor: ${p.name}.`);
            } else {
                alert(`¬°BIEN! ${p.name} ERA impostor. Queda${aliveImpos > 1 ? 'n' : ''} ${aliveImpos} m√°s...`);
                renderVoteList();
            }
        } else {
            if (aliveCits <= aliveImpos) {
                showResult("¬°GAN√ì EL IMPOSTOR! üòà", `Echaron a ${p.name} y los ciudadanos perdieron la mayor√≠a.`);
            } else {
                alert(`¬°MAL AH√ç! ${p.name} era INOCENTE. El juego sigue.`);
                renderVoteList();
            }
        }
    }

    function checkImpostorGuess() {
        const guessInput = document.getElementById('impostorGuessInput');
        const guess = guessInput.value.toLowerCase().trim();
        
        // Filtramos qui√©nes son los impostores que siguen en juego
        const aliveImpos = players.filter(p => p.role === 'Impostor' && p.alive);
        
        if(guess === secretWord.toLowerCase().trim()) {
            // Victoria colectiva: mapeamos los nombres para el anuncio final
            const nombres = aliveImpos.map(p => p.name).join(" y ");
            showResult("¬°GANARON LOS IMPOSTORES! üòà", `${nombres} descubrieron la palabra: ${secretWord.toUpperCase()}`);
        } else { 
            // Penalizaci√≥n por arriesgar mal
            alert(`¬°ERROR! Los impostores arriesgaron mal y perdieron la chance de ganar por palabra.`); 
            showScreen('debate-screen'); 
            document.getElementById('impostor-guess-zone').classList.add('hidden'); 
            guessInput.value = ""; // Limpiamos el input para la pr√≥xima
        }
    }

    function showResult(title, msg) {
        clearInterval(timerInterval);
        showScreen('result-screen');
        document.getElementById('result-title').innerText = title;
        document.getElementById('result-text').innerText = msg + `\n\nLa palabra era: ${secretWord.toUpperCase()}`;
    }
    
    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('pause-btn');
        // Cambiamos el √≠cono seg√∫n el estado
        btn.innerText = isPaused ? "‚ñ∂" : "‚è∏";
    }

    function confirmExit() {
        if (confirm("¬øSeguro que quer√©s volver al inicio? Se perder√° el progreso de esta partida.")) {
            clearInterval(timerInterval);
            showScreen('setup-screen');
        }
    }

    function resetGame() { currentIndex = 0; players = []; secretWord = ""; showScreen('setup-screen'); }
    function showScreen(id) { document.querySelectorAll('.container').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); window.scrollTo(0,0); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function toggleCustomWord() { const source = document.getElementById('wordSource').value; document.getElementById('customWordDiv').classList.toggle('hidden', source !== 'custom'); }
    function sugerirPalabra() { window.open('https://ig.me/m/terrepolis', '_blank'); }
    function compartirJuego() {
        const data = { title: 'üá¶üá∑ El Impostor', text: '¬°Che, mir√° este juego para la previa!', url: 'https://elimpostor.ar' };
        if (navigator.share) navigator.share(data);
        else { navigator.clipboard.writeText(data.url); alert("¬°Link copiado!"); }
    }

    initSetup();

        // ============================================
    // INSTALAR APP - C√ìDIGO COMPLETO Y LIMPIO
    // ============================================
    // Peg√° esto DESPU√âS de initSetup() y ANTES de forceUpdateApp()

    function setupInstallButton() {
        const installBtn = document.getElementById('install-btn');
        if (!installBtn) return;

        const ua = navigator.userAgent;
        const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
        
        // Detecci√≥n M√ÅS ESTRICTA de Safari - solo Safari REAL
        const isSafari = isIOS && 
                        !(/CriOS|FxiOS|EdgiOS|OPiOS|Instagram|FBAN|FBAV|Twitter|Line/i.test(ua)) &&
                        !(navigator.brave !== undefined);
        
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                            window.navigator.standalone === true;

        // Si ya est√° instalada, no mostrar bot√≥n
        if (isStandalone) {
            installBtn.style.display = 'none';
            return;
        }

        // MOSTRAR BOT√ìN
        installBtn.style.display = 'block';

        // --- CASO 1: iOS ---
        if (isIOS) {
            const isChromeIOS = /CriOS/i.test(ua);
            const isBraveIOS = navigator.brave !== undefined;
            const isFirefoxIOS = /FxiOS/i.test(ua);
            const isEdgeIOS = /EdgiOS/i.test(ua);
            const isInAppBrowser = /Instagram|FBAN|FBAV|Twitter|Line/i.test(ua);

            installBtn.innerText = 'üì≤ INSTALAR APP';
            installBtn.style.backgroundColor = 'var(--oro)';
            installBtn.style.color = 'black';

            if (isChromeIOS) {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN CHROME (iPhone):\n\n1. Toc√° compartir (‚¨ÜÔ∏è) arriba a la derecha\n2. Eleg√≠ 'Agregar a pantalla de inicio'\n3. Toc√° 'Agregar'");
                };
            } else if (isBraveIOS) {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN BRAVE (iPhone):\n\n1. Toc√° el √≠cono de men√∫ (‚ò∞) abajo a la izquierda\n2. Desliz√° hacia arriba y eleg√≠ 'Agregar a Inicio'\n3. Confirm√° 'Agregar'\n\nüí° O toc√° Compartir (‚ó≤) ‚Üí Agregar a pantalla de inicio");
                };
            } else if (isFirefoxIOS) {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN FIREFOX (iPhone):\n\n1. Toc√° los 3 puntos (‚ãØ) abajo a la derecha\n2. Eleg√≠ 'Compartir'\n3. Seleccion√° 'Agregar a pantalla de inicio'");
                };
            } else if (isEdgeIOS) {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN EDGE (iPhone):\n\n1. Toc√° los 3 puntos (¬∑¬∑¬∑) abajo\n2. Eleg√≠ 'Agregar a tel√©fono'\n3. Confirm√° 'Agregar'");
                };
            } else if (isInAppBrowser) {
                installBtn.innerText = 'üåê ABRIR EN NAVEGADOR';
                installBtn.style.backgroundColor = '#ff6b6b';
                installBtn.onclick = () => {
                    const url = window.location.href;
                    navigator.clipboard.writeText(url).then(() => {
                        alert("NO SE PUEDE INSTALAR DESDE ESTA APP.\n\n‚úÖ Link copiado.\n\n1. Abr√≠ Safari o Chrome\n2. Peg√° el link\n3. Segu√≠ las instrucciones para instalar");
                    }).catch(() => {
                        alert("Copi√° este link y abrilo en Safari o Chrome:\n\nhttps://elimpostor.ar");
                    });
                };
            } else if (isSafari) {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN SAFARI:\n\n1. Toc√° el bot√≥n 'Compartir' (‚¨ÜÔ∏è) abajo\n2. Desliz√° y eleg√≠ 'Agregar a pantalla de inicio'\n3. Confirm√° 'Agregar'");
                };
            } else {
                installBtn.onclick = () => {
                    alert("PARA INSTALAR EN TU NAVEGADOR:\n\n1. Busc√° el men√∫ del navegador (‚ãØ o ‚ò∞)\n2. Busc√° 'Compartir' o 'Agregar a inicio'\n\nüí° Recomendado: Abr√≠ en Safari para mejor experiencia");
                };
            }
            return;
        }

        // --- CASO 2: ANDROID ---
        installBtn.innerText = 'üì≤ INSTALAR APP';
        installBtn.style.backgroundColor = 'var(--oro)';
        installBtn.style.color = 'black';

        // Capturar el evento de instalaci√≥n
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        installBtn.onclick = async () => {
            if (deferredPrompt) {
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        installBtn.style.display = 'none';
                    }
                    deferredPrompt = null;
                } catch (err) {
                    console.log('Error al mostrar prompt:', err);
                    showManualInstructions(ua);
                }
            } else {
                showManualInstructions(ua);
            }
        };

        // Ocultar bot√≥n si ya se instal√≥
        window.addEventListener('appinstalled', () => {
            installBtn.style.display = 'none';
        });
    }

    function showManualInstructions(ua) {
        const isSamsung = /SamsungBrowser/i.test(ua);
        const isBrave = navigator.brave !== undefined;
        const isEdge = /Edg/i.test(ua);
        const isFirefox = /Firefox/i.test(ua);
        const isOpera = /OPR|Opera/i.test(ua);
        const isUCBrowser = /UCBrowser/i.test(ua);
        const isInAppBrowser = /Instagram|FBAN|FBAV|Twitter|Line|WhatsApp/i.test(ua);
        
        if (isInAppBrowser) {
            alert("NO SE PUEDE INSTALAR DESDE ESTA APP.\n\n1. Toc√° los 3 puntos (‚ãÆ) arriba\n2. Eleg√≠ 'Abrir en navegador' o 'Abrir en Chrome'\n3. Segu√≠ las instrucciones para instalar");
        } else if (isBrave) {
            alert("PARA INSTALAR EN BRAVE:\n\n1. Toc√° el men√∫ (‚ò∞) o los 3 puntos (‚ãÆ)\n2. Busc√° 'Instalar Impostor Argento' o 'Agregar a pantalla de inicio'\n3. Confirm√° 'Instalar'");
        } else if (isSamsung) {
            alert("PARA INSTALAR EN SAMSUNG INTERNET:\n\n1. Toc√° el men√∫ (‚ò∞) abajo\n2. Eleg√≠ 'Agregar p√°gina a'\n3. Seleccion√° 'Pantalla de inicio'\n4. Confirm√° 'Agregar'");
        } else if (isEdge) {
            alert("PARA INSTALAR EN EDGE:\n\n1. Toc√° los 3 puntos (¬∑¬∑¬∑) abajo\n2. Toc√° 'Aplicaciones'\n3. Seleccion√° 'Instalar Impostor Argento'\n4. Confirm√° 'Instalar'");
        } else if (isFirefox) {
            alert("PARA INSTALAR EN FIREFOX:\n\n1. Toc√° los 3 puntos (‚ãÆ) arriba\n2. Toc√° 'Instalar'\n\nüí° O busc√° la opci√≥n 'Agregar a pantalla de inicio'");
        } else if (isOpera) {
            alert("PARA INSTALAR EN OPERA:\n\n1. Toc√° el men√∫ de Opera\n2. Busc√° 'Agregar a pantalla de inicio'\n3. Confirm√° 'Agregar'");
        } else if (isUCBrowser) {
            alert("PARA INSTALAR EN UC BROWSER:\n\n1. Toc√° el men√∫ principal\n2. Eleg√≠ 'Agregar acceso directo'\n3. Confirm√°");
        } else {
            alert("PARA INSTALAR:\n\n1. Toc√° los 3 puntos (‚ãÆ) arriba del navegador\n2. Busc√° 'Instalar app' o 'Agregar a pantalla de inicio'\n3. Confirm√° 'Instalar'\n\nüí° Funciona mejor en Chrome");
        }
    }

    // EJECUTAR cuando el DOM est√© listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupInstallButton);
    } else {
        setupInstallButton();
    }

    // 2. Ejecutar todo cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', () => {
        // A. Cargar racha personal guardada
        const matchCountLocal = parseInt(localStorage.getItem('mis_partidas_total')) || 0;
        const mCounter = document.getElementById('match-counter');
        if(mCounter) mCounter.innerText = matchCountLocal;

        // B. Mostrar versi√≥n actual
        const label = document.getElementById('version-label');
        if(label) label.innerText = "Versi√≥n Actual: V" + APP_VERSION;

        // C. Inicializar bot√≥n de instalaci√≥n
        setupInstallButton();

       // D. Registrar Service Worker con la versi√≥n actual
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js') // <--- Quitamos el ?v= para frenar el bucle
                .then(reg => {
                    console.log("SW registrado");
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Solo recarga cuando realmente hay una versi√≥n nueva lista
                                window.location.reload();
                            }
                        };
                    };
                });
        }
    });

    // 3. Funci√≥n para forzar actualizaci√≥n (Bot√≥n del men√∫)
    async function forceUpdateApp() {
    if (confirm("¬øQuer√©s buscar actualizaciones? La App se reiniciar√°.")) {
        if ('serviceWorker' in navigator) {
            const regs = await navigator.serviceWorker.getRegistrations();
            for (let reg of regs) {
                await reg.update(); // En lugar de borrar, le pide que busque cambios
            }
        }
        window.location.reload();
    }
    }
    </script>
</body>
</html>